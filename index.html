<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Touch Grass Simulator 🌱</title>
  <link rel="icon" href="images/grass.png">
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#0b1220; color:#e9f0ff;
           display:flex; flex-direction:column; align-items:center; min-height:100vh; padding:10px; }
    h1 { margin:0.5em 0; }
    .board { width:90%; max-width:500px; height:500px; background:#18243e;
             position:relative; border-radius:12px; overflow:hidden; }
    .player { position:absolute; left:20px; top:20px; width:48px; height:48px; }
    .player img { width:100%; height:100%; }
    .grass { position:absolute; right:0; bottom:0; width:100px; height:100px; }
    .grass img { width:100%; height:100%; }
    .tile,.bubble { position:absolute; display:flex; flex-direction:column;
                    align-items:center; text-align:center; }
    .tile img,.bubble img { width:50px; height:50px; }
    .tile span,.bubble span { font-size:10px; color:#fff; }
    .hud { margin:10px 0; }
    .toast { position:absolute; top:10px; left:50%; transform:translateX(-50%);
             background:#111a2b; padding:8px 14px; border-radius:8px; opacity:0;
             transition:opacity 0.3s; }
    .toast.show { opacity:1; }
    .overlay { position:absolute; inset:0; background:rgba(0,0,0,0.7); display:none;
               align-items:center; justify-content:center; flex-direction:column;
               color:white; text-align:center; z-index:10; }
    .overlay button { margin:6px; padding:8px 14px; border:none; border-radius:6px;
                      background:#213152; color:white; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Touch Grass Simulator 🌱</h1>
  <div class="hud">
    <span>Score: <span id="score">0</span></span> |
    <span>Time: <span id="timer">30</span>s</span> |
    <span>Level: <span id="level">1</span></span>
    <button id="mute">🔊 Mute</button>
  </div>

  <div class="board" id="board">
    <div class="grass" id="grass"><img src="images/grass.png" alt="grass"></div>
    <div class="player" id="player"><img src="images/player.png" alt="player"></div>
    <div class="toast" id="toast"></div>
    <div class="overlay" id="overlay">
      <h2 id="end-title">Level Complete!</h2>
      <p id="end-desc">You touched grass!</p>
      <button id="restart">Start Over</button>
      <button id="next">Next Level</button>
    </div>
  </div>

  <!-- 🎵 Background music -->
  <audio id="bg-music" loop>
    <source src="images/music.mp3" type="audio/mpeg">
  </audio>

  <script>
    const board=document.getElementById('board'),
      player=document.getElementById('player'),
      grass=document.getElementById('grass'),
      toast=document.getElementById('toast'),
      overlay=document.getElementById('overlay'),
      endTitle=document.getElementById('end-title'),
      endDesc=document.getElementById('end-desc'),
      restartBtn=document.getElementById('restart'),
      nextBtn=document.getElementById('next'),
      muteBtn=document.getElementById('mute'),
      scoreEl=document.getElementById('score'),
      timerEl=document.getElementById('timer'),
      levelEl=document.getElementById('level'),
      bgMusic=document.getElementById('bg-music');

    let dragging=false,offsetX=0,offsetY=0;
    let score=0,time=30,level=1,running=true,muted=false;
    let bubbles=[],tiles=[];
    let pendingX=20,pendingY=20;

    const badHabits=[{img:"images/doomscroll.png",label:"Doomscrolling"},
                     {img:"images/brainrot.png",label:"Brain Rot"},
                     {img:"images/procrastinate.png",label:"Procrastinate"}];
    const goodVibes=[{img:"images/vibe.png",label:"Vibe+1"},
                     {img:"images/grassboost.png",label:"Grass Power"},
                     {img:"images/sun.png",label:"Vitamin D"}];

    const rageTile=["🔥 Back to spawn, bot.","💀 NPC detected.","📉 Skill issue…"];
    const rageTime=["⌛ Ran out of time, doomscroller.","😭 Couldn't even touch grass."];
    const winMsgs=["🌱 Fresh air unlocked!","✨ Your sanity +10."];

    function beep(f=440,d=0.1){
      if(muted) return;
      const ctx=new (window.AudioContext||window.webkitAudioContext)();
      const o=ctx.createOscillator(),g=ctx.createGain();
      o.connect(g);g.connect(ctx.destination);
      o.frequency.value=f;o.type="sine";g.gain.value=0.05;
      o.start();o.stop(ctx.currentTime+d);
    }
    function showToast(m){ toast.textContent=m; toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'),1000); }

    function resetPlayer(){ pendingX=20; pendingY=20;
      player.style.left="20px"; player.style.top="20px"; }

    function spawnTile(){
      const data=badHabits[Math.floor(Math.random()*badHabits.length)];
      const t=document.createElement('div');
      t.className="tile";
      t.style.left=(60+Math.random()*350)+"px";
      t.style.top=(20+Math.random()*350)+"px";
      const img=document.createElement("img"); img.src=data.img;
      const label=document.createElement("span"); label.textContent=data.label;
      t.appendChild(img); t.appendChild(label);
      board.appendChild(t);
      t.vx=(Math.random()<0.5?-1:1)*(2+level);
      t.vy=(Math.random()<0.5?-1:1)*(2+level);
      tiles.push(t);
    }

    function spawnBubble(){
      const data=goodVibes[Math.floor(Math.random()*goodVibes.length)];
      const b=document.createElement('div');
      b.className="bubble";
      b.style.left=(Math.random()*400)+"px";
      b.style.top=(Math.random()*400)+"px";
      const img=document.createElement("img"); img.src=data.img;
      const label=document.createElement("span"); label.textContent=data.label;
      b.appendChild(img); b.appendChild(label);
      board.appendChild(b);
      bubbles.push({el:b});
      setTimeout(()=>{b.remove();bubbles=bubbles.filter(x=>x.el!==b)},5000);
    }

    function tick(){
      if(!running) return;
      time--; timerEl.textContent=time;
      if(time<=0){ gameOver(false); }
    }
    setInterval(tick,1000);

    function checkCollisions(){ if(!running) return;
      const pr=player.getBoundingClientRect(), gr=grass.getBoundingClientRect();
      const px=pr.left+pr.width/2, py=pr.top+pr.height/2;
      if(px>gr.left && px<gr.right && py>gr.top && py<gr.bottom){ gameOver(true); }
      tiles.forEach(t=>{ const tr=t.getBoundingClientRect();
        if(!(tr.right<pr.left||tr.left>pr.right||tr.bottom<pr.top||tr.top>pr.bottom)){
          resetPlayer(); showToast(rageTile[Math.floor(Math.random()*rageTile.length)]);
          beep(300,0.15);
        }
      });
      bubbles.forEach(b=>{ const br=b.el.getBoundingClientRect();
        if(!(br.right<pr.left||br.left>pr.right||br.bottom<pr.top||br.top>pr.bottom)){
          score++; scoreEl.textContent=score;
          showToast("✨ "+b.el.innerText); beep(600,0.1);
        }
      });
    }

    function gameOver(won){
      running=false; overlay.style.display="flex";
      if(won){
        endTitle.textContent="Level "+level+" Complete!";
        endDesc.textContent=winMsgs[Math.floor(Math.random()*winMsgs.length)];
        nextBtn.style.display="inline-block"; // ✅ show next if win
        score+=10; scoreEl.textContent=score; beep(800,0.15);
      } else {
        endTitle.textContent="Game Over";
        endDesc.textContent=rageTime[Math.floor(Math.random()*rageTime.length)];
        nextBtn.style.display="none"; // ❌ hide next if lose
        beep(200,0.2);
      }
    }

    function updatePlayer(){
      if(pendingX!==null&&pendingY!==null){
        player.style.left=pendingX+"px"; player.style.top=pendingY+"px";
        checkCollisions();
      }
      requestAnimationFrame(updatePlayer);
    }
    requestAnimationFrame(updatePlayer);

    // mouse drag
    board.addEventListener("mousedown", e=>{ dragging=true; offsetX=e.offsetX; offsetY=e.offsetY; startMusic(); });
    document.addEventListener("mouseup",()=>dragging=false);
    document.addEventListener("mousemove",e=>{
      if(!dragging||!running) return;
      let rect=board.getBoundingClientRect(),
          x=e.clientX-rect.left-offsetX,
          y=e.clientY-rect.top-offsetY;
      pendingX=Math.max(0,Math.min(rect.width-40,x));
      pendingY=Math.max(0,Math.min(rect.height-40,y));
    });

    // touch drag
    player.addEventListener("touchstart", e=>{
      e.preventDefault(); startMusic();
      dragging=true; const touch=e.touches[0];
      const rect=player.getBoundingClientRect();
      offsetX=touch.clientX-rect.left; offsetY=touch.clientY-rect.top;
    },{passive:false});
    document.addEventListener("touchend",()=>dragging=false);
    document.addEventListener("touchmove",e=>{
      if(!dragging||!running) return; e.preventDefault();
      const touch=e.touches[0];
      let rect=board.getBoundingClientRect(),
          x=touch.clientX-rect.left-offsetX,
          y=touch.clientY-rect.top-offsetY;
      pendingX=Math.max(0,Math.min(rect.width-40,x));
      pendingY=Math.max(0,Math.min(rect.height-40,y));
    },{passive:false});

    function startLevel(lv){
      level=lv; levelEl.textContent=level;
      time=Math.max(10,30-(lv-1)*3); timerEl.textContent=time;
      tiles.forEach(t=>t.remove()); tiles=[]; bubbles.forEach(b=>b.el.remove()); bubbles=[];
      for(let i=0;i<lv+1;i++) spawnTile();
      running=true; overlay.style.display="none"; resetPlayer();
    }

    restartBtn.onclick=()=>{
      overlay.style.display="none"; level=1; score=0; scoreEl.textContent=0; startLevel(1);
    };
    nextBtn.onclick=()=>{
      overlay.style.display="none"; startLevel(level+1);
    };
    muteBtn.onclick=()=>{
      muted=!muted;
      muteBtn.textContent=muted?"🔇 Unmute":"🔊 Mute";
      if(muted) bgMusic.pause(); else bgMusic.play();
    };

    setInterval(()=>{ if(running) spawnBubble(); },2000);

    function moveTiles(){ if(!running) return;
      const rect=board.getBoundingClientRect();
      tiles.forEach(t=>{
        let x=t.offsetLeft+t.vx, y=t.offsetTop+t.vy;
        if(x<=0||x+60>=rect.width) t.vx*=-1;
        if(y<=0||y+60>=rect.height) t.vy*=-1;
        t.style.left=Math.max(0,Math.min(rect.width-60,x))+"px";
        t.style.top=Math.max(0,Math.min(rect.height-60,y))+"px";
      });
    }
    setInterval(moveTiles,30);

    // 🎵 Start music once user interacts
    function startMusic(){
      if(!muted && bgMusic.paused){
        bgMusic.volume=0.4;
        bgMusic.play().catch(()=>{});
      }
    }

    // boot
    startLevel(1);
  </script>
</body>
</html>
